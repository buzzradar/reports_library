<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="   sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,800&display=swap" rel="stylesheet">

    <link href="css/report-AA-SocialIntel-audience-vs-content.css" rel="stylesheet">

    <title>Buzz Radar Reports Page</title>

  </head>

  <body>

    <div id="report_slide" class="report-aa-socialintel-audience-vs-content" style="top:{{slideTop}}px;">

      <div class="slide-background">
        
        <div class="bubbles">
          <div class="b-top"></div>
          <div class="b-middle"></div>
          <div class="b-bottom"></div>
        </div>
        <div class="left-bar orange"></div>
        <div class="right-bar orange"></div>
        <div class="vertical"></div>

      </div>

      <div class="slide">
          
          <div class="report_title">
              <div class="top">{{report.name}}</div>
              <div class="bottom">Audience Comparison with Content</div>
          </div>

          <div class="content">


            <div class="main-layout-wrap">
              <div class="col1">
                <div class="col_title">Audience Overview</div>
                <div id="gauge1_graph" class="graph_wrap" style="height:580px;"></div>
              </div>
              <div class="col2">
                <div class="col_title">Content Overview</div>
                <div id="gauge2_graph" class="graph_wrap" style="height:580px;"></div>
              </div>
              <div class="col3">
                <div class="col_title">Content Audience Match</div>
                <div id="metric_graph" class="graph_wrap" style="height:580px;"></div>
                <div class="card">
                  <h3>This will be replaced by Vito</h3>
                  <p>Curabitur pulvinar metus in consectetur lacinia. Donec facilisis felis non ultrices interdum. Etiam volutpat, neque eget aliquet euismod, lacus orci mollis libero, non facilisis neque sapien at tortor. Etiam.</p>
                </div>
              </div>
            </div>

          </div>


      </div>

      <div class="footer">
          <div class="date-range">Date Range: {{fromDate | date('jS M Y') }} - {{ toDate | date('jS M Y') }}</div>
          <img src="https://3c90f21d2e52d99af65d-cc7a500d9b10d65e67a8ddf30b9c21f5.ssl.cf3.rackcdn.com/reports_imgs/logos/RGB_NAME_WHITEBG_SMALL72.png" width="200">
      </div>

    </div>





    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/gauge.js"></script>


    <script>

      var AASocialIntelAudienceContentInstance = function () {

        var pageDataJS = {"audienceAnalyserVsContent":{"audience":{"personality_name":"Commander","personality_description":"You are strict.\nYou are confident: you are hard to embarrass and are self-confident most of the time. You are down-to-earth: you prefer facts over fantasy. And you are uncompromising: you think it is wrong to take advantage of others to get ahead.\nExperiences that give a sense of belongingness hold some appeal to you.\nYou are relatively unconcerned with both taking pleasure in life and independence. You prefer activities with a purpose greater than just personal enjoyment. And you welcome when others direct your activities for you.","fullname":"","avatar":"","watson_profile":{"personality":[{"name":"Openness","percentile":0.67,"children":[{"name":"Adventurousness","percentile":0.42},{"name":"Artistic interests","percentile":0.5},{"name":"Emotionality","percentile":0.44},{"name":"Imagination","percentile":0.03},{"name":"Intellect","percentile":0.33},{"name":"Authority-challenging","percentile":0.26}]},{"name":"Conscientiousness","percentile":0.83,"children":[{"name":"Achievement striving","percentile":0.77},{"name":"Cautiousness","percentile":0.84},{"name":"Dutifulness","percentile":0.82},{"name":"Orderliness","percentile":0.74},{"name":"Self-discipline","percentile":0.84},{"name":"Self-efficacy","percentile":0.55}]},{"name":"Extraversion","percentile":0.58,"children":[{"name":"Activity level","percentile":0.89},{"name":"Assertiveness","percentile":0.61},{"name":"Cheerfulness","percentile":0.38},{"name":"Excitement-seeking","percentile":0.11},{"name":"Outgoing","percentile":0.81},{"name":"Gregariousness","percentile":0.88}]},{"name":"Agreeableness","percentile":0.24,"children":[{"name":"Altruism","percentile":0.86},{"name":"Cooperation","percentile":0.9},{"name":"Modesty","percentile":0.92},{"name":"Uncompromising","percentile":0.93},{"name":"Sympathy","percentile":0.35},{"name":"Trust","percentile":0.78}]},{"name":"Emotional range","percentile":0.36,"children":[{"name":"Fiery","percentile":0.13},{"name":"Prone to worry","percentile":0.16},{"name":"Melancholy","percentile":0.2},{"name":"Immoderation","percentile":0.76},{"name":"Self-consciousness","percentile":0.03},{"name":"Susceptible to stress","percentile":0.25}]},{"name":"Needs","percentile":0.5,"children":[{"name":"Challenge","percentile":0.07},{"name":"Closeness","percentile":0.4},{"name":"Curiosity","percentile":0.04},{"name":"Excitement","percentile":0.1},{"name":"Harmony","percentile":0.17},{"name":"Ideal","percentile":0.04},{"name":"Liberty","percentile":0.09},{"name":"Love","percentile":0.13},{"name":"Practicality","percentile":0.05},{"name":"Self-expression","percentile":0.1},{"name":"Stability","percentile":0.24},{"name":"Structure","percentile":0.21}]},{"name":"Values","percentile":0.5,"children":[{"name":"Conservation","percentile":0.42},{"name":"Openness to change","percentile":0.13},{"name":"Hedonism","percentile":0.1},{"name":"Self-enhancement","percentile":0.37},{"name":"Self-transcendence","percentile":0.25}]}],"needs":[{"name":"Challenge","percentile":0.07},{"name":"Closeness","percentile":0.4},{"name":"Curiosity","percentile":0.04},{"name":"Excitement","percentile":0.1},{"name":"Harmony","percentile":0.17},{"name":"Ideal","percentile":0.04},{"name":"Liberty","percentile":0.09},{"name":"Love","percentile":0.13},{"name":"Practicality","percentile":0.05},{"name":"Self-expression","percentile":0.1},{"name":"Stability","percentile":0.24},{"name":"Structure","percentile":0.21}],"values":[{"name":"Conservation","percentile":0.42},{"name":"Openness to change","percentile":0.13},{"name":"Hedonism","percentile":0.1},{"name":"Self-enhancement","percentile":0.37},{"name":"Self-transcendence","percentile":0.25}]}},"content":[]}};


        var pageId = '';
        var slideDom = $('#report_slide'+pageId);
        console.log("Unique Page ID:", "report_slide"+pageId);
        console.log(pageDataJS);
        var gaugeChart;

        var loadPersonalityOverviewGraph = function(graphID, personalityBreakdownData){

            if (personalityBreakdownData.length == 0) {
              slideDom.find('#'+graphID).html('<div class="no-data">There is no data to display this graph.</div>');
              return false;
            }

            personalityBreakdownData = personalityBreakdownData.watson_profile.personality;

            //-----------------------------------------------------------------------
            //DEVELOPER NOTE!
            //We need to include Needs and Values.
            // this.personality_MO = _addNeedsValues(this.personality_MO);
            //-----------------------------------------------------------------------

            var colorArray = ['#84b761','#fdd400','#cc4748','#67b7dc','#ffaf30','#d88fe8','#bfc442'];
            var bands = [];
            var allLabels = [];
            var bandValue = 100;
            var startY = 3;

            $.each(personalityBreakdownData, function( index, value ) {

                var radius = bandValue;
                var innerRadius = bandValue - 8;

                bands.push({
                  "color": "#eee",
                  "startValue": 0,
                  "endValue": 100,
                  "radius": radius + "%",
                  "innerRadius": innerRadius +"%",
                  "title" : value.name,
                  "dataChild" : value,
                  "colorBandClick" : colorArray[index],
                }, {
                  "color": colorArray[index],
                  "startValue": 0,
                  "endValue": (value.percentile * 100).toFixed(0),
                  "radius": radius+"%",
                  "innerRadius": innerRadius+"%",
                  "balloonText": (value.percentile * 100).toFixed(0) + "%",
                  "title" : value.name,
                  "colorBandClick" : colorArray[index],
                  "dataChild" : value,
                });

                bandValue -= 13;

                allLabels.push({
                  "text": value.name,
                  "x": "49%",
                  "y": startY+"%",
                  "size": 15,
                  "bold": true,
                  "color": colorArray[index],
                  "align": "right"
                });

                startY += 6;

            });

            AmCharts.makeChart(graphID, {
                "type": "gauge",
                "theme": "none",
                "addClassNames": true,
                "axes": [{
                  "axisAlpha": 0,
                  "tickAlpha": 0,
                  "labelsEnabled": false,
                  "startValue": 0,
                  "endValue": 100,
                  "startAngle": 0,
                  "endAngle": 270,
                  "bands": bands,
                }],
                "allLabels": allLabels,
                "export": {
                  "enabled": false
                }
              });

          };



          var loadContentAudienceMatch = function () {

              var id = slideDom.find('#metric_graph').get(0);
              var AudiencePersonality = pageDataJS.audienceAnalyserVsContent.audience;
              var ContentPersonality = pageDataJS.audienceAnalyserVsContent.content;

              if (AudiencePersonality && AudiencePersonality.watson_profile && ContentPersonality && ContentPersonality.watson_profile){
                var tempSum = 0;

                for (i = 0; i < ContentPersonality.watson_profile.personality.length; i++) {          
                  tempSum += parseInt(getPersonalityCalculation(ContentPersonality.watson_profile.personality[i].name))
                  if (tempSum > 0 && ContentPersonality.watson_profile.personality.length) {
                    var valToDisplay = (tempSum/ContentPersonality.watson_profile.personality.length).toFixed(0, 10);

                    // console.clear();
                    // console.log(valToDisplay);

                    setTimeout(function() {
                      gaugeChart.arrows[0].setValue(valToDisplay);
                      gaugeChart.axes[0].setTopText(valToDisplay + " %");
                      gaugeChart.axes[0].bands[1].setEndValue(valToDisplay);

                      setTimeout(function() {
                        $('path').attr('stroke','transparent');
                      },50);

                    },200);

                  }



                }

              }
          };


          var getPersonalityCalculation = function(persName){

            var AudiencePersonality = pageDataJS.audienceAnalyserVsContent.audience;
            var ContentPersonality = pageDataJS.audienceAnalyserVsContent.content;

            if (persName && AudiencePersonality && AudiencePersonality.watson_profile && ContentPersonality && ContentPersonality.watson_profile){          
                //get childrerns for this trait
                for (i = 0; i < ContentPersonality.watson_profile.personality.length; i++) {          
                    if (ContentPersonality.watson_profile.personality[i].name == persName){
                        var dataChild = ContentPersonality.watson_profile.personality[i]
                        var sum = 0;                  
                        $.each(dataChild.children, function( index, value ) {
                            var v1 = getValueForChart(AudiencePersonality, dataChild.name, value.name);
                            var v2 = getValueForChart(ContentPersonality, dataChild.name, value.name);
                            if (v1/v2 > 1) {
                              sum +=  v2/v1
                            } else {
                              sum += v1/v2
                            }
                            //sum += Math.abs(getValueForChart(AudiencePersonality, dataChild.name, value.name) - getValueForChart(ContentPersonality, dataChild.name, value.name))
                            //console.log('one vs other ' + v1 + ' <-->' +  v2)
                        });
                        if (sum > 0) {
                          var value = 100 * (sum/dataChild.children.length)
                          //console.log(value.toFixed(0, 10))
                          return value.toFixed(0, 10)
                        }
                    }
                }
            }
                return 0;
          };


          var getValueForChart = function(profile, category, trait){      
            if (!profile) return 0;
            if (!profile.watson_profile) return 0;
            if (!profile.watson_profile.personality) return 0;

            for (i = 0; i < profile.watson_profile.personality.length; i++) { 
              if (profile.watson_profile.personality[i].name == category){
                for (j = 0; j < profile.watson_profile.personality[i].children.length; j++) { 
                  if (profile.watson_profile.personality[i].children[j].name == trait){
                    return (profile.watson_profile.personality[i].children[j].percentile * 100).toFixed(0);
                  }
                }
              }
            }
            return 0;
          };



        var loadChart = function() {

          gaugeChart = AmCharts.makeChart(metric_graph, {
            "theme": "none",
            "addClassNames": true,
            "type": "gauge",
            "startDuration" : 0,
            "axes": [{
              "topTextFontSize": 20,
              "topTextYOffset": 70,
              "axisColor": "#31d6ea",
              "axisThickness": 1,
              "endValue": 100,
              "gridInside": true,
              "inside": true,
              "radius": "50%",
              "valueInterval": 10,
              "tickColor": "#67b7dc",
              "startAngle": -90,
              "endAngle": 90,
              "unit": "%",
              "bandOutlineAlpha": 0,
              "bands": [{
                "color": "#ce4d4a",
                "endValue": 100,
                "innerRadius": "105%",
                "radius": "170%",
                "startValue": 0
              }, {
                "color": "#87bd40",
                "endValue": 0,
                "innerRadius": "105%",
                "radius": "170%",
                "startValue": 0
              }]
            }],
            "arrows": [{
              "alpha": 1,
              "innerRadius": "35%",
              "nailRadius": 0,
              "radius": "170%"
            }]
          });

        };


        return {
            init: function () {
              loadChart();

              loadPersonalityOverviewGraph('gauge1_graph', pageDataJS.audienceAnalyserVsContent.audience);
              loadPersonalityOverviewGraph('gauge2_graph', pageDataJS.audienceAnalyserVsContent.content);
              
              loadContentAudienceMatch();


              setTimeout(function() {
                $('path').attr('stroke','transparent');
              },200);
            }
        };
        
      }();

      AASocialIntelAudienceContentInstance.init();
          
    </script>


  </body>
</html>
